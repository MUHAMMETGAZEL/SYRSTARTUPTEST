<!--<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>خريطة منظومة الابتكار في سوريا - Startup Syria</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0d1b2a 0%, #1b263b 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
            color: #fff;
            overflow-x: hidden;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(76, 161, 175, 0.3);
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #ff7e5f, #feb47b, #4ca1af, #2c3e50, #9d4edd);
        }
        
        .header h1 {
            color: #fff;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 0 0 15px rgba(76, 161, 175, 0.7);
        }
        
        .header h2 {
            color: #4ca1af;
            font-size: 1.8rem;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .header p {
            color: #a8dadc;
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .map-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex: 1;
            position: relative;
            margin: 30px auto;
            max-width: 1200px;
            width: 100%;
            height: 85vh;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(76, 161, 175, 0.3);
        }
        
        #flourish-container {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: relative;
        }
        
        .flourish-embed {
            width: 100%;
            height: 100%;
            border: none;
            transform-origin: center;
            transition: transform 0.3s ease;
        }
        
        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(20, 30, 50, 0.8);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
            z-index: 10;
            border: 1px solid rgba(76, 161, 175, 0.5);
        }
        
        .legend h3 {
            color: #ffd166;
            margin-bottom: 10px;
            text-align: center;
            font-size: 1.3rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-left: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .legend-text {
            font-size: 1rem;
            color: #a8dadc;
        }
        
        .footer {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            color: #a8dadc;
            font-size: 1.1rem;
            border: 1px solid rgba(76, 161, 175, 0.3);
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .highlight {
            color: #4ca1af;
            font-weight: 600;
            text-shadow: 0 0 8px rgba(76, 161, 175, 0.7);
        }
        
        .title-row {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto 20px;
        }
        
        .title-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: 600;
            color: #a8dadc;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .title-box i {
            font-size: 1.4rem;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #4ca1af;
            color: #a8dadc;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-btn:hover {
            background: rgba(76, 161, 175, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 0 10px rgba(76, 161, 175, 0.5);
        }
        
        .statistics {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            min-width: 150px;
            text-align: center;
            border: 1px solid rgba(76, 161, 175, 0.3);
            transition: all 0.3s ease;
        }
        
        .stat-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(76, 161, 175, 0.3);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #4ca1af;
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(76, 161, 175, 0.5);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #a8dadc;
        }
        
        .description {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            text-align: center;
            color: #a8dadc;
            line-height: 1.6;
        }
        
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(13, 27, 42, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            transition: opacity 0.5s ease;
        }
        
        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #4ca1af;
            border-bottom-color: transparent;
            border-radius: 50%;
            display: inline-block;
            animation: rotation 1s linear infinite;
        }
        
        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            margin-top: 20px;
            font-size: 1.2rem;
            color: #a8dadc;
        }
        
        .zoom-level {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(20, 30, 50, 0.8);
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 1.1rem;
            color: #ffd166;
            z-index: 10;
            display: none;
            animation: fadeInOut 2s ease;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .header h2 {
                font-size: 1.5rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .map-container {
                height: 75vh;
            }
            
            .title-box {
                font-size: 1rem;
                padding: 8px 15px;
            }
            
            .legend {
                bottom: 10px;
                left: 10px;
                padding: 10px;
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 480px) {
            .map-container {
                height: 65vh;
            }
            
            .legend {
                position: relative;
                width: 90%;
                margin: 10px auto;
                bottom: auto;
                left: auto;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .control-btn {
                width: 90%;
            }
            
            .title-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .header {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .header h2 {
                font-size: 1.3rem;
            }
        }
        
        .tooltip {
            position: absolute;
            background: rgba(20, 30, 50, 0.95);
            color: white;
            padding: 15px;
            border-radius: 10px;
            pointer-events: none;
            font-size: 1.1rem;
            border: 1px solid #4ca1af;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.3s;
            max-width: 300px;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
    </style>
</head>
<body>
    <div class="title-row">
        <div class="title-box">
            <i class="fas fa-question-circle"></i>
            <span>Question Support</span>
        </div>
        <div class="title-box">
            <i class="fas fa-flag"></i>
            <span>Strategy Syria</span>
        </div>
    </div>
    
    <div class="header">
        <h1>خريطة منظومة الابتكار في سوريا</h1>
        <h2>Startup Syria</h2>
        <p>تم تحديث الخريطة باستخدام منصة Flourish المتقدمة لتقديم تجربة تفاعلية متكاملة</p>
    </div>
    
    <div class="controls">
        <button class="control-btn" id="fullscreen-btn">
            <i class="fas fa-expand"></i>
            <span>عرض كامل الشاشة</span>
        </button>
        <button class="control-btn" id="reset-view">
            <i class="fas fa-sync-alt"></i>
            <span>إعادة تعيين العرض</span>
        </button>
        <button class="control-btn" id="zoom-in-btn">
            <i class="fas fa-search-plus"></i>
            <span>تكبير</span>
        </button>
        <button class="control-btn" id="zoom-out-btn">
            <i class="fas fa-search-minus"></i>
            <span>تصغير</span>
        </button>
    </div>
    
    <div class="map-container">
        <div class="loading-overlay" id="loading-overlay">
            <div class="loader"></div>
            <div class="loading-text">جاري تحميل الخريطة التفاعلية...</div>
        </div>
        <div class="tooltip"></div>
        <div class="zoom-level" id="zoom-level">التكبير: 100%</div>
        
        
        <div id="flourish-container">
            <div class="flourish-embed flourish-hierarchy" data-src="visualisation/24076143">
                <script src="https://public.flourish.studio/resources/embed.js"></script>
            </div>
        </div>
    </div>
    
    <div class="description">
        <p>تقدم هذه الخريطة التفاعلية رؤية شاملة لمنظومة الابتكار في سوريا، حيث يمكنك استكشاف مختلف المكونات والعلاقات بين الجهات الفاعلة في النظام البيئي للابتكار. استخدم أدوات التحكم للتفاعل مع الخريطة واستكشاف البيانات.</p>
    </div>
    
    <div class="statistics">
        <div class="stat-box">
            <div class="stat-value">42</div>
            <div class="stat-label">منظمة داعمة</div>
        </div>
        <div class="stat-box">
            <div class="stat-value">18</div>
            <div class="stat-label">حاضنة أعمال</div>
        </div>
        <div class="stat-box">
            <div class="stat-value">127</div>
            <div class="stat-label">مشروع ناشئ</div>
        </div>
        <div class="stat-box">
            <div class="stat-value">$5.2M</div>
            <div class="stat-label">استثمارات</div>
        </div>
    </div>
    
    <div class="footer">
        <p>Source: <span class="highlight">Data Collected by Startup Syria 2025</span> | Powered by <span class="highlight">Flourish Studio</span></p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mapContainer = document.querySelector('.map-container');
            const loadingOverlay = document.getElementById('loading-overlay');
            const tooltip = document.querySelector('.tooltip');
            const zoomLevel = document.getElementById('zoom-level');
            const flourishContainer = document.getElementById('flourish-container');
            const flourishEmbed = document.querySelector('.flourish-embed');
            
            
            setTimeout(() => {
                loadingOverlay.style.opacity = '0';
                setTimeout(() => {
                    loadingOverlay.style.display = 'none';
                }, 500);
            }, 2000);
            
            
            document.getElementById('fullscreen-btn').addEventListener('click', function() {
                if (mapContainer.requestFullscreen) {
                    mapContainer.requestFullscreen();
                } else if (mapContainer.mozRequestFullScreen) { // Firefox
                    mapContainer.mozRequestFullScreen();
                } else if (mapContainer.webkitRequestFullscreen) { // Chrome, Safari and Opera
                    mapContainer.webkitRequestFullscreen();
                } else if (mapContainer.msRequestFullscreen) { // IE/Edge
                    mapContainer.msRequestFullscreen();
                }
            });
            
           
            document.getElementById('reset-view').addEventListener('click', function() {
                
                loadingOverlay.style.display = 'flex';
                loadingOverlay.style.opacity = '1';
                
                
                flourishEmbed.style.transform = 'scale(1)';
                
                
                zoomLevel.textContent = 'التكبير: 100%';
                zoomLevel.style.display = 'block';
                
                setTimeout(() => {
                    loadingOverlay.style.opacity = '0';
                    setTimeout(() => {
                        loadingOverlay.style.display = 'none';
                    }, 500);
                    
                   
                    setTimeout(() => {
                        zoomLevel.style.display = 'none';
                    }, 2000);
                }, 1000);
            });
            
          
            document.getElementById('zoom-in-btn').addEventListener('click', function() {
                let currentScale = parseFloat(flourishEmbed.style.transform.replace('scale(', '').replace(')', '')) || 1;
                if (currentScale < 2) {
                    currentScale += 0.1;
                    flourishEmbed.style.transform = `scale(${currentScale})`;
                    
                    
                    zoomLevel.textContent = `التكبير: ${Math.round(currentScale * 100)}%`;
                    zoomLevel.style.display = 'block';
                    
                   
                    setTimeout(() => {
                        zoomLevel.style.display = 'none';
                    }, 2000);
                } else {
                    tooltip.innerHTML = '<strong>الحد الأقصى للتكبير</strong><br>لا يمكن التكبير أكثر من ذلك';
                    tooltip.style.opacity = 1;
                    tooltip.style.left = '50%';
                    tooltip.style.top = '50%';
                    tooltip.style.transform = 'translate(-50%, -50%)';
                    
                    setTimeout(() => {
                        tooltip.style.opacity = 0;
                    }, 1500);
                }
            });
            
            
            document.getElementById('zoom-out-btn').addEventListener('click', function() {
                let currentScale = parseFloat(flourishEmbed.style.transform.replace('scale(', '').replace(')', '')) || 1;
                if (currentScale > 0.5) {
                    currentScale -= 0.1;
                    flourishEmbed.style.transform = `scale(${currentScale})`;
                    
                    
                    zoomLevel.textContent = `التكبير: ${Math.round(currentScale * 100)}%`;
                    zoomLevel.style.display = 'block';
                    
                    
                    setTimeout(() => {
                        zoomLevel.style.display = 'none';
                    }, 2000);
                } else {
                    tooltip.innerHTML = '<strong>الحد الأدنى للتصغير</strong><br>لا يمكن التصغير أكثر من ذلك';
                    tooltip.style.opacity = 1;
                    tooltip.style.left = '50%';
                    tooltip.style.top = '50%';
                    tooltip.style.transform = 'translate(-50%, -50%)';
                    
                    setTimeout(() => {
                        tooltip.style.opacity = 0;
                    }, 1500);
                }
            });
            
            // Initialize tooltip position on mouse move
            document.addEventListener('mousemove', function(e) {
                if (tooltip.style.opacity === '1') {
                    tooltip.style.left = (e.pageX + 10) + 'px';
                    tooltip.style.top = (e.pageY - 30) + 'px';
                }
            });
            
            
            flourishContainer.addEventListener('wheel', function(e) {
                e.preventDefault();
                let currentScale = parseFloat(flourishEmbed.style.transform.replace('scale(', '').replace(')', '')) || 1;
                
                if (e.deltaY < 0) {
                    // تكبير
                    if (currentScale < 2) {
                        currentScale += 0.1;
                        flourishEmbed.style.transform = `scale(${currentScale})`;
                    }
                } else {
                    // تصغير
                    if (currentScale > 0.5) {
                        currentScale -= 0.1;
                        flourishEmbed.style.transform = `scale(${currentScale})`;
                    }
                }
                
               
                zoomLevel.textContent = `التكبير: ${Math.round(currentScale * 100)}%`;
                zoomLevel.style.display = 'block';
                
                setTimeout(() => {
                    zoomLevel.style.display = 'none';
                }, 2000);
            });
        });
    </script>
</body>
</html>
-->










<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>خريطة منظومة الابتكار في سوريا - Startup Syria</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0d1b2a 0%, #1b263b 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
            color: #fff;
            overflow-x: hidden;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(76, 161, 175, 0.3);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #ff7e5f, #feb47b, #4ca1af, #2c3e50, #9d4edd);
        }
        
        .header h1 {
            color: #fff;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 0 0 15px rgba(76, 161, 175, 0.7);
        }
        
        .header h2 {
            color: #4ca1af;
            font-size: 1.8rem;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .header p {
            color: #a8dadc;
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .map-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex: 1;
            position: relative;
            margin: 30px auto;
            max-width: 800px;
            width: 100%;
            height: 80vh;
            perspective: 1000px;
        }
        
        #concentric-map {
            width: 100%;
            height: 100%;
            position: relative;
            transition: transform 0.8s ease-in-out;
        }
        
        .center-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, #4ca1af, #2c3e50);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            text-align: center;
            box-shadow: 
                0 0 30px rgba(76, 161, 175, 0.8),
                inset 0 0 20px rgba(0, 0, 0, 0.3);
            border: 3px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            z-index: 100;
            animation: pulse 3s infinite;
            transition: all 0.5s ease;
        }
        
        .center-circle h3 {
            font-size: 1.5rem;
            margin-bottom: 5px;
            color: #ffd166;
        }
        
        .center-circle p {
            font-size: 0.9rem;
            padding: 0 15px;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 161, 175, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(76, 161, 175, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 161, 175, 0); }
        }
        
        .tooltip {
            position: absolute;
            background: rgba(20, 30, 50, 0.95);
            color: white;
            padding: 15px;
            border-radius: 10px;
            pointer-events: none;
            font-size: 1.1rem;
            border: 1px solid #4ca1af;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.3s;
            max-width: 300px;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(20, 30, 50, 0.8);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
            z-index: 10;
            border: 1px solid rgba(76, 161, 175, 0.5);
        }
        
        .legend h3 {
            color: #ffd166;
            margin-bottom: 10px;
            text-align: center;
            font-size: 1.3rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-left: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .legend-text {
            font-size: 1rem;
            color: #a8dadc;
        }
        
        .footer {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            color: #a8dadc;
            font-size: 1.1rem;
            border: 1px solid rgba(76, 161, 175, 0.3);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .highlight {
            color: #4ca1af;
            font-weight: 600;
            text-shadow: 0 0 8px rgba(76, 161, 175, 0.7);
        }
        
        .sector-label {
            position: absolute;
            color: white;
            font-weight: bold;
            text-align: center;
            pointer-events: none;
            text-shadow: 0 0 5px rgba(0,0,0,0.8);
            z-index: 50;
        }
        
        .title-row {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 800px;
            margin: 0 auto 20px;
        }
        
        .title-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: 600;
            color: #a8dadc;
        }
        
        .subsection-label {
            position: absolute;
            text-align: center;
            font-size: 10px;
            font-weight: bold;
            z-index: 80;
            pointer-events: none;
            fill: #ffffff;
            text-shadow: 0 0 2px rgba(0,0,0,0.8);
        }
        
        .inner-label {
            position: absolute;
            text-align: center;
            font-size: 13px;
            font-weight: bold;
            z-index: 90;
            pointer-events: none;
            line-height: 1.3;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .header h2 {
                font-size: 1.5rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .map-container {
                height: 70vh;
            }
            
            .center-circle {
                width: 120px;
                height: 120px;
            }
            
            .center-circle h3 {
                font-size: 1.2rem;
            }
            
            .center-circle p {
                font-size: 0.8rem;
            }
            
            .title-box {
                font-size: 1rem;
                padding: 8px 15px;
            }
            
            .legend {
                bottom: 10px;
                left: 10px;
                padding: 10px;
                font-size: 0.9rem;
            }
            
            .sector-label {
                font-size: 16px;
            }
            
            .inner-label {
                font-size: 11px;
            }
            
            .subsection-label {
                font-size: 8px;
            }
        }
        
        @media (max-width: 480px) {
            .map-container {
                height: 60vh;
            }
            
            .center-circle {
                width: 100px;
                height: 100px;
            }
            
            .center-circle h3 {
                font-size: 1rem;
            }
            
            .legend {
                position: relative;
                width: 90%;
                margin: 10px auto;
                bottom: auto;
                left: auto;
            }
            
            .inner-label {
                font-size: 10px;
            }
            
            .subsection-label {
                font-size: 6px;
            }
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #4ca1af;
            color: #a8dadc;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-btn:hover {
            background: rgba(76, 161, 175, 0.3);
            transform: translateY(-2px);
        }
        
        .control-btn i {
            font-size: 1.2rem;
        }
        
        .statistics {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            min-width: 150px;
            text-align: center;
            border: 1px solid rgba(76, 161, 175, 0.3);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #4ca1af;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #a8dadc;
        }
        
        .subsection-item {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .subsection-item:hover {
            opacity: 1 !important;
            filter: brightness(1.2);
        }
        
        .rotation-controls {
            display: flex;
            gap: 10px;
        }
        
        .rotation-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(76, 161, 175, 0.3);
            border: 1px solid #4ca1af;
            color: #a8dadc;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .rotation-btn:hover {
            background: rgba(76, 161, 175, 0.5);
            transform: scale(1.1);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1b263b 0%, #0d1b2a 100%);
            width: 90%;
            max-width: 500px;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(76, 161, 175, 0.5);
            position: relative;
            transform: translateY(-20px);
            transition: all 0.4s ease;
        }
        
        .modal.active .modal-content {
            transform: translateY(0);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(76, 161, 175, 0.3);
        }
        
        .modal-title {
            color: #ffd166;
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .close-btn {
            background: transparent;
            border: none;
            color: #a8dadc;
            font-size: 1.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            color: #ff7e5f;
            transform: rotate(90deg);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: #a8dadc;
            font-size: 1.1rem;
        }
        
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid #4ca1af;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            border-color: #ffd166;
            box-shadow: 0 0 10px rgba(255, 209, 102, 0.3);
            outline: none;
        }
        
        .form-group textarea {
            height: 120px;
            resize: vertical;
        }
        
        .form-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }
        
        .form-btn {
            flex: 1;
            padding: 12px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .form-btn.primary {
            background: linear-gradient(135deg, #4ca1af, #2c3e50);
            color: white;
        }
        
        .form-btn.primary:hover {
            background: linear-gradient(135deg, #3d8c99, #1b263b);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .form-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #a8dadc;
            border: 1px solid #4ca1af;
        }
        
        .form-btn.secondary:hover {
            background: rgba(76, 161, 175, 0.2);
            transform: translateY(-3px);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(76, 161, 175, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 3000;
            display: none;
            animation: slideIn 0.5s forwards, fadeOut 0.5s forwards 2.5s;
            max-width: 350px;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }
        
        .notification-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .notification-icon {
            font-size: 2rem;
            color: #ffd166;
        }
        
        .notification-text h3 {
            margin-bottom: 5px;
            font-size: 1.2rem;
        }
        
        .notification-text p {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .section-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid rgba(76, 161, 175, 0.3);
            border-radius: 8px;
            padding: 10px;
        }
        
        .section-item {
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-item:hover {
            background: rgba(76, 161, 175, 0.2);
            transform: translateX(-5px);
        }
        
        .section-item.active {
            background: rgba(76, 161, 175, 0.3);
            border-left: 4px solid #ffd166;
        }
        
        .section-name {
            font-weight: 600;
            color: #a8dadc;
        }
        
        .section-id {
            background: rgba(255, 209, 102, 0.2);
            color: #ffd166;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .section-link {
            font-size: 0.85rem;
            color: #4ca1af;
            margin-top: 5px;
            display: block;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            direction: ltr;
            text-align: left;
        }
        
        .link-icon {
            color: #ff7e5f;
            margin-left: 5px;
        }
        
        .link-button {
            cursor: pointer;
            transition: all 0.3s ease;
            pointer-events: all; /* تمكين الأحداث */
        }
        
        .link-icon {
            font-size: 14px;
            fill: #4ca1af;
            transition: all 0.3s ease;
        }
        
        .link-button:hover .link-icon {
            fill: #ffd166;
            transform: scale(1.2);
        }
        
        .link-icon-text {
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            font-size: 14px;
            fill: #4ca1af;
            transition: all 0.3s ease;
        }
        
        .database-info {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #4ca1af;
        }
        
        .db-icon {
            color: #ffd166;
        }
        
        .breadcrumb {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 10px auto;
            max-width: 800px;
        }
        
        .breadcrumb-item {
            padding: 5px 15px;
            background: rgba(76, 161, 175, 0.2);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .breadcrumb-item:hover {
            background: rgba(76, 161, 175, 0.4);
        }
        
        .breadcrumb-item.active {
            background: rgba(76, 161, 175, 0.6);
            font-weight: bold;
        }
        
        .subsection-label text {
            pointer-events: none; /* منع أحداث الماوس للنص */
        }
        
        /* تأثيرات الانتقال الجديدة */
        .map-transition {
            transition: all 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .license-control {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }
        
        .license-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #4ca1af;
            color: white;
            padding: 10px 15px;
            border-radius: 30px;
            width: 200px;
            text-align: center;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin-right: 10px;
        }
        
        .license-input:focus {
            border-color: #ffd166;
            box-shadow: 0 0 10px rgba(255, 209, 102, 0.3);
            outline: none;
        }
        
        .license-btn {
            background: linear-gradient(135deg, #4ca1af, #2c3e50);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .license-btn:hover {
            background: linear-gradient(135deg, #3d8c99, #1b263b);
            transform: translateY(-2px);
        }
        
        .license-status {
            text-align: center;
            margin-top: 5px;
            font-size: 0.9rem;
            color: #a8dadc;
        }
        
        .license-active {
            color: #06d6a0;
        }
        
        .license-inactive {
            color: #ff7e5f;
        }
        
        .transition-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(13, 27, 42, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }
        
        .transition-overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .transition-content {
            text-align: center;
            color: #ffd166;
            font-size: 2rem;
            font-weight: bold;
            text-shadow: 0 0 15px rgba(255, 209, 102, 0.7);
        }
        
        .transition-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(76, 161, 175, 0.3);
            border-top: 5px solid #4ca1af;
            border-radius: 50%;
            margin: 20px auto;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="title-row">
        <div class="title-box">Question Support</div>
        <div class="title-box">Strategy Syria</div>
    </div>
    
    <div class="header">
        <h1>خريطة منظومة الابتكار في سوريا</h1>
        <h2>Startup Syria</h2>
        <p>نظام إدارة متكامل مع تأثيرات انتقالية متقدمة</p>
    </div>
    
    <div class="license-control">
        <input type="password" class="license-input" id="license-input" placeholder="أدخل مفتاح الترخيص">
        <button class="license-btn" id="license-btn">تفعيل الترخيص</button>
    </div>
    <div class="license-status" id="license-status">
        <span class="license-inactive"><i class="fas fa-times-circle"></i> الترخيص غير مفعل</span>
    </div>
    
    <div class="breadcrumb" id="breadcrumb">
        <div class="breadcrumb-item active" id="main-breadcrumb">الخريطة الرئيسية</div>
    </div>
    
    <div class="controls">
        <button class="control-btn" id="reset-view">
            <i class="fas fa-sync-alt"></i> إعادة تعيين العرض
        </button>
        <button class="control-btn" id="add-section">
            <i class="fas fa-plus-circle"></i> إضافة قسم جديد
        </button>
        <button class="control-btn" id="edit-section">
            <i class="fas fa-edit"></i> تعديل الأقسام
        </button>
        <div class="rotation-controls">
            <div class="rotation-btn" id="rotate-left" title="تدوير لليسار">
                <i class="fas fa-undo"></i>
            </div>
            <div class="rotation-btn" id="rotate-right" title="تدوير لليمين">
                <i class="fas fa-redo"></i>
            </div>
        </div>
    </div>
    
    <div class="map-container">
        <div class="transition-overlay" id="transition-overlay">
            <div class="transition-content">
                <div class="transition-spinner"></div>
                <div>جاري تحميل البيانات...</div>
            </div>
        </div>
        <div id="concentric-map"></div>
        <div class="center-circle">
            <h3>سوريا</h3>
            <p>المركز الرئيسي</p>
        </div>
        <div class="tooltip"></div>
    </div>
    
    <div class="notification" id="notification">
        <div class="notification-content">
            <div class="notification-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="notification-text">
                <h3 id="notification-title">تمت العملية بنجاح!</h3>
                <p id="notification-message">تم إضافة قسم جديد بنجاح</p>
            </div>
        </div>
    </div>
    
    <div class="statistics">
        <div class="stat-box">
            <div class="stat-value">42</div>
            <div class="stat-label">منظمة داعمة</div>
        </div>
        <div class="stat-box">
            <div class="stat-value">18</div>
            <div class="stat-label">حاضنة أعمال</div>
        </div>
        <div class="stat-box">
            <div class="stat-value">127</div>
            <div class="stat-label">مشروع ناشئ</div>
        </div>
        <div class="stat-box">
            <div class="stat-value">$5.2M</div>
            <div class="stat-label">استثمارات</div>
        </div>
    </div>
    
    <div class="footer">
        <div class="database-info">
            <i class="fas fa-database db-icon"></i>
            <span>جميع التغييرات محفوظة في قاعدة البيانات المحلية</span>
        </div>
        <p>Source: <span class="highlight">Data Collected by Startup Syria 2025</span></p>
    </div>
    
    <!-- Modal for adding new section -->
    <div class="modal" id="add-section-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">إضافة قسم جديد</h3>
                <button class="close-btn" id="close-add-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="form-group">
                <label for="new-section-name">اسم القسم الجديد</label>
                <input type="text" id="new-section-name" placeholder="أدخل اسم القسم الجديد هنا">
            </div>
            <div class="form-group">
                <label for="section-link">رابط القسم (اختياري)</label>
                <input type="url" id="section-link" placeholder="https://example.com">
            </div>
            <div class="form-actions">
                <button class="form-btn secondary" id="cancel-add-btn">
                    <i class="fas fa-times"></i> إلغاء
                </button>
                <button class="form-btn primary" id="confirm-add-btn">
                    <i class="fas fa-plus"></i> إضافة القسم
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal for editing sections -->
    <div class="modal" id="edit-section-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">تعديل الأقسام</h3>
                <button class="close-btn" id="close-edit-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="form-group">
                <label for="section-select">اختر القسم للتعديل</label>
                <div class="section-list" id="section-list">
                    <!-- Sections will be populated here -->
                </div>
            </div>
            <div class="form-group">
                <label for="edit-section-content">اسم القسم الجديد</label>
                <input type="text" id="edit-section-content" placeholder="أدخل الاسم الجديد للقسم">
            </div>
            <div class="form-group">
                <label for="edit-section-link">رابط القسم</label>
                <input type="url" id="edit-section-link" placeholder="https://example.com">
            </div>
            <div class="form-actions">
                <button class="form-btn secondary" id="cancel-edit-btn">
                    <i class="fas fa-times"></i> إلغاء
                </button>
                <button class="form-btn primary" id="confirm-edit-btn">
                    <i class="fas fa-save"></i> حفظ التغييرات
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const width = 800;
            const height = 800;
            const centerX = width / 2;
            const centerY = height / 2;
            
            // إنشاء SVG
            const svg = d3.select("#concentric-map")
                .append("svg")
                .attr("width", "100%")
                .attr("height", "100%")
                .attr("viewBox", `0 0 ${width} ${height}`)
                .attr("preserveAspectRatio", "xMidYMid meet");
            
            // تعريف الحلقات (الدوائر المتداخلة)
            const rings = [
                { id: 1, innerRadius: 50, outerRadius: 150, name: "الحلقة الداخلية", color: "rgba(76, 161, 175, 0.3)" },
                { id: 2, innerRadius: 150, outerRadius: 250, name: "الحلقة الوسطى", color: "rgba(255, 126, 95, 0.3)" },
                { id: 3, innerRadius: 250, outerRadius: 350, name: "الحلقة الخارجية", color: "rgba(255, 209, 102, 0.3)" }
            ];
            
            // تعريف القطاعات (الفئات) مع الأقسام الفرعية
            const sectors = [
                { 
                    id: 1, 
                    name: "التمويل والاستثمار", 
                    color: "#ff7e5f", 
                    startAngle: 0, 
                    endAngle: 2*Math.PI/5, 
                    subsections: [
                        "Seed Funding",
                        "Venture Capital",
                        "Angel Investors",
                        "Crowdfunding",
                        "Islamic Finance",
                        "Growth Capital",
                        "IPO Support"
                    ]
                },
                { 
                    id: 2, 
                    name: "التعليم والبحث", 
                    color: "#4ca1af", 
                    startAngle: 2*Math.PI/5, 
                    endAngle: 4*Math.PI/5, 
                    subsections: [
                        "STEM Education",
                        "University Programs",
                        "Vocational Training",
                        "Tech Bootcamps",
                        "R&D Centers",
                        "Innovation Labs"
                    ]
                },
                { 
                    id: 3, 
                    name: "البنية التحتية", 
                    color: "#ffd166", 
                    startAngle: 4*Math.PI/5, 
                    endAngle: 6*Math.PI/5, 
                    subsections: [
                        "Co-working Spaces",
                        "Tech Incubators",
                        "Manufacturing Hubs"
                    ]
                },
                { 
                    id: 4, 
                    name: "الدعم والاستشارات", 
                    color: "#06d6a0", 
                    startAngle: 6*Math.PI/5, 
                    endAngle: 8*Math.PI/5, 
                    subsections: [
                        "Legal Support",
                        "Marketing Strategy",
                        "Mentorship",
                        "Business Planning"
                    ]
                },
                { 
                    id: 5, 
                    name: "السياسات والتنظيم", 
                    color: "#9d4edd", 
                    startAngle: 8*Math.PI/5, 
                    endAngle: 2*Math.PI, 
                    subsections: [
                        "Regulatory Framework",
                        "Tax Incentives",
                        "Startup Licenses",
                        "Export Policies",
                        "Labor Regulations",
                        "Compliance",
                        "Environmental Standards"
                    ]
                }
            ];
            
            // متغير لتتبع القسم النشط
            let activeSection = null;
            
            // متغير لتتبع زاوية التدوير
            let rotationAngle = 0;
            
            // متغير لتخزين عدد الأقسام في الدائرة الجديدة
            let sectionCount = 8;
            
            // قاعدة البيانات المحلية لكل قسم
            let sectionDatabase = {};
            
            // متغير لتتبع مستوى التعشيش (لحل المشكلة)
            let nestingLevel = 0;
            const MAX_NESTING_LEVEL = 1; // المستوى الأقصى للتعشيش المسموح به
            
            // متغيرات الترخيص
            const validLicenseKey = "gazalm7";
            let licenseActive = false;
            
            // عناصر الترخيص
            const licenseInput = document.getElementById('license-input');
            const licenseBtn = document.getElementById('license-btn');
            const licenseStatus = document.getElementById('license-status');
            
            // تحديث واجهة الترخيص
            function updateLicenseUI() {
                if (licenseActive) {
                    licenseStatus.innerHTML = '<span class="license-active"><i class="fas fa-check-circle"></i> الترخيص مفعل</span>';
                    document.getElementById('add-section').style.display = 'flex';
                    document.getElementById('edit-section').style.display = 'flex';
                } else {
                    licenseStatus.innerHTML = '<span class="license-inactive"><i class="fas fa-times-circle"></i> الترخيص غير مفعل</span>';
                    document.getElementById('add-section').style.display = 'none';
                    document.getElementById('edit-section').style.display = 'none';
                }
            }
            
            // تحقق من الترخيص
            licenseBtn.addEventListener('click', function() {
                if (licenseInput.value === validLicenseKey) {
                    licenseActive = true;
                    showNotification('تم التفعيل بنجاح!', 'تم تفعيل الترخيص بنجاح');
                } else {
                    licenseActive = false;
                    showNotification('خطأ في الترخيص', 'مفتاح الترخيص غير صحيح');
                }
                updateLicenseUI();
            });
            
            // تحميل البيانات من localStorage
            function loadData() {
                const savedData = localStorage.getItem('innovationMapData');
                if (savedData) {
                    sectionDatabase = JSON.parse(savedData);
                } else {
                    // تهيئة قاعدة البيانات إذا لم توجد
                    initializeDatabase();
                }
            }
            
            // حفظ البيانات إلى localStorage
            function saveData() {
                localStorage.setItem('innovationMapData', JSON.stringify(sectionDatabase));
            }
            
            // تهيئة قاعدة البيانات
            function initializeDatabase() {
                sectors.forEach(sector => {
                    sector.subsections.forEach(subsection => {
                        sectionDatabase[subsection] = {
                            sectionNames: Array.from({length: sectionCount}, (_, i) => `القسم ${i+1}`),
                            sectionLinks: Array(sectionCount).fill('')
                        };
                    });
                });
                saveData();
            }
            
            // تحديث شريط التصفح
            function updateBreadcrumb(currentSection) {
                const breadcrumb = document.getElementById('breadcrumb');
                breadcrumb.innerHTML = `
                    <div class="breadcrumb-item" id="main-breadcrumb">الخريطة الرئيسية</div>
                    <div class="breadcrumb-item active">${currentSection}</div>
                `;
                
                document.getElementById('main-breadcrumb').addEventListener('click', function() {
                    transitionBackToMain();
                });
            }
            
            // دالة لرسم الخريطة
            function drawMap() {
                // مسح SVG الحالي
                svg.selectAll("*").remove();
                
                // رسم الحلقات مع القطاعات مع تطبيق التدوير
                rings.forEach(ring => {
                    sectors.forEach(sector => {
                        // تطبيق التدوير على زوايا القطاع
                        const startAngle = sector.startAngle + rotationAngle;
                        const endAngle = sector.endAngle + rotationAngle;
                        
                        // للحلقة الوسطى والخارجية: تقسيم القطاع إلى أقسام فرعية
                        if (ring.id === 2 || ring.id === 3) {
                            const sectorAngleRange = endAngle - startAngle;
                            const subsectionAngle = sectorAngleRange / sector.subsections.length;
                            
                            // رسم كل قسم فرعي في الحلقة
                            for (let i = 0; i < sector.subsections.length; i++) {
                                const subsectionName = sector.subsections[i];
                                const subsectionStartAngle = startAngle + i * subsectionAngle;
                                const subsectionEndAngle = subsectionStartAngle + subsectionAngle;
                                
                                const arcGenerator = d3.arc()
                                    .innerRadius(ring.innerRadius)
                                    .outerRadius(ring.outerRadius)
                                    .startAngle(subsectionStartAngle)
                                    .endAngle(subsectionEndAngle);
                                
                                const path = svg.append("path")
                                    .attr("d", arcGenerator())
                                    .attr("transform", `translate(${centerX}, ${centerY})`)
                                    .attr("fill", sector.color)
                                    .attr("stroke", "white")
                                    .attr("stroke-width", 1)
                                    .attr("opacity", 0.8)
                                    .attr("class", "subsection")
                                    .attr("data-sector", sector.id)
                                    .attr("data-subsection", i)
                                    .on("mouseover", function(event) {
                                        d3.select(this).attr("opacity", 1);
                                        
                                        // إظهار التلميح
                                        const tooltip = document.querySelector('.tooltip');
                                        tooltip.innerHTML = `
                                            <strong>${sector.name}</strong><br>
                                            <em>${ring.name}</em><br>
                                            القسم: ${subsectionName}
                                        `;
                                        tooltip.style.opacity = 1;
                                        tooltip.style.left = (event.pageX + 10) + 'px';
                                        tooltip.style.top = (event.pageY - 30) + 'px';
                                    })
                                    .on("mouseout", function() {
                                        d3.select(this).attr("opacity", 0.8);
                                        document.querySelector('.tooltip').style.opacity = 0;
                                    });
                                
                                // إضافة حدث النقر فقط للحلقة الوسطى (ring.id === 2) وفي المستوى الأساسي (nestingLevel === 0)
                                if (ring.id === 2 && nestingLevel === 0) {
                                    path.on("click", function() {
                                        nestingLevel++;
                                        createNewCircleMap(subsectionName);
                                    });
                                }
                                
                                // إضافة نص القسم الفرعي فقط للحلقة الوسطى
                                if (ring.id === 2) {
                                    const middleAngle = subsectionStartAngle + subsectionAngle / 2;
                                    const textRadius = (ring.innerRadius + ring.outerRadius) / 2;
                                    
                                    // تطبيق التصحيح الصحيح للزاوية
                                    const correctedAngle = middleAngle + 4.728;
                                    
                                    const x = centerX + textRadius * Math.cos(correctedAngle);
                                    const y = centerY + textRadius * Math.sin(correctedAngle);
                                    
                                    // حساب زاوية التدوير للنص
                                    let rotation = (middleAngle * 180 / Math.PI) + 89;
                                    
                                    // إضافة 180 درجة للنصوص في النصف السفلي لتصحيح اتجاهها
                                    if (rotation > 90 && rotation < 270) {
                                        rotation += 180;
                                    }
                                    
                                    // إنشاء مجموعة للتدوير
                                    const g = svg.append("g")
                                        .attr("transform", `translate(${x}, ${y}) rotate(${rotation})`)
                                        .attr("class", "subsection-label");
                                    
                                    // تقسيم النص إذا كان طويلاً
                                    const labelText = subsectionName;
                                    const maxCharsPerLine = 12;
                                    let lines = [];
                                    
                                    if (labelText.length > maxCharsPerLine) {
                                        const words = labelText.split(' ');
                                        let line = "";
                                        words.forEach(word => {
                                            if ((line + word).length <= maxCharsPerLine) {
                                                line += (line ? " " : "") + word;
                                            } else {
                                                lines.push(line);
                                                line = word;
                                            }
                                        });
                                        if (line) lines.push(line);
                                    } else {
                                        lines = [labelText];
                                    }
                                    
                                    // حساب موضع كل سطر
                                    const lineHeight = 12;
                                    const startY = -((lines.length - 1) * lineHeight) / 2;
                                    
                                    lines.forEach((line, index) => {
                                        g.append("text")
                                            .attr("x", 0)
                                            .attr("y", startY + index * lineHeight)
                                            .attr("text-anchor", "middle")
                                            .attr("dy", "0.35em")
                                            .attr("fill", "#ffffff")
                                            .attr("font-size", "10px")
                                            .attr("font-weight", "bold")
                                            .text(line);
                                    });
                                }
                            }
                        } else {
                            // للحلقة الداخلية: رسم القطاع ككيان واحد
                            const arcGenerator = d3.arc()
                                .innerRadius(ring.innerRadius)
                                .outerRadius(ring.outerRadius)
                                .startAngle(startAngle)
                                .endAngle(endAngle);
                            
                            const path = svg.append("path")
                                .attr("d", arcGenerator())
                                .attr("transform", `translate(${centerX}, ${centerY})`)
                                .attr("fill", sector.color)
                                .attr("stroke", "white")
                                .attr("stroke-width", 1)
                                .attr("opacity", 0.8)
                                .attr("class", "sector")
                                .attr("data-sector", sector.id)
                                .on("mouseover", function(event) {
                                    d3.select(this).attr("opacity", 1);
                                    
                                    // إظهار التلميح
                                    const tooltip = document.querySelector('.tooltip');
                                    tooltip.innerHTML = `
                                        <strong>${sector.name}</strong><br>
                                        <em>${ring.name}</em>
                                    `;
                                    tooltip.style.opacity = 1;
                                    tooltip.style.left = (event.pageX + 10) + 'px';
                                    tooltip.style.top = (event.pageY - 30) + 'px';
                                })
                                .on("mouseout", function() {
                                    d3.select(this).attr("opacity", 0.8);
                                    document.querySelector('.tooltip').style.opacity = 0;
                                });
                        }
                    });
                });
                
                // إضافة دوائر متقطعة لتوضيح المستويات
                for (let r = 50; r <= 350; r += 100) {
                    svg.append("circle")
                        .attr("cx", centerX)
                        .attr("cy", centerY)
                        .attr("r", r)
                        .attr("fill", "none")
                        .attr("stroke", "rgba(255, 255, 255, 0.2)")
                        .attr("stroke-dasharray", "5,5")
                        .attr("stroke-width", 1);
                }
                
                // عناوين الحلقة الداخلية
                const innerLabels = [
                    { 
                        lines: [
                            "Regulations and",
                            "Government Support"
                        ], 
                        color: "#4ca1af",
                        angle: Math.PI * 0.5 + rotationAngle
                    },
                    { 
                        lines: [
                        "Ideation Support"
                        ], 
                        color: "#06d6a0",
                        angle: Math.PI * 1.7 + rotationAngle
                    },
                    { 
                        lines: [
                        "Networking and",
                            "Cultures"
                        ], 
                        color: "#ff7e5f",
                        angle: Math.PI * 0.9 + rotationAngle
                    },
                    { 
                        lines: [
                        "Operation, Growth",
                            "and Markets"
                        ], 
                        color: "#9d4edd",
                        angle: Math.PI * 0.1 + rotationAngle
                    },
                    { 
                        lines: [
                        "Funding"
                        ], 
                        color: "#ffd166",
                        angle: Math.PI * 3.3 + rotationAngle
                    }
                ];

                const innerRadius = 100;
                
                innerLabels.forEach((label) => {
                    const x = centerX + innerRadius * Math.cos(label.angle);
                    const y = centerY + innerRadius * Math.sin(label.angle);
                    
                    // تحديد زاوية الدوران للنص
                    let rotation = (label.angle * 180 / Math.PI) + 90;
                    
                    // إضافة 180 درجة للنصوص في النصف السفلي لتصحيح اتجاهها
                    if (rotation > 90 && rotation < 270) {
                        rotation += 180;
                    }
                    
                    // إضافة عنصر g لتجميع الأسطر
                    const g = svg.append("g")
                        .attr("transform", `translate(${x}, ${y}) rotate(${rotation})`)
                        .attr("class", "inner-label");
                    
                    // حساب ارتفاع النص لضبط المسافات
                    const lineHeight = 15;
                    const startY = -((label.lines.length - 1) * lineHeight) / 2;
                    
                    // إضافة كل سطر من النص
                    label.lines.forEach((line, i) => {
                        if (line === "Funding") {
                            g.append("text")
                                .attr("x", 0)
                                .attr("y", startY + i * lineHeight - 4)
                                .attr("text-anchor", "middle")
                                .attr("dy", "0.35em")
                                .attr("fill", label.color)
                                .attr("font-size", "15px")
                                .attr("font-weight", "bold")
                                .text(line);
                        } else {
                            g.append("text")
                                .attr("x", 0)
                                .attr("y", startY + i * lineHeight)
                                .attr("text-anchor", "middle")
                                .attr("dy", "0.35em")
                                .attr("fill", label.color)
                                .attr("font-size", "13px")
                                .attr("font-weight", "bold")
                                .text(line);
                        }
                    });
                });
            }
            
            // دالة لإنشاء دائرة جديدة مع تأثيرات انتقالية
            function createNewCircleMap(subsectionName) {
                // إظهار شاشة الانتقال
                const transitionOverlay = document.getElementById('transition-overlay');
                transitionOverlay.classList.add('active');
                
                setTimeout(() => {
                    // مسح الخريطة الحالية
                    svg.selectAll("*").remove();
                    
                    // تحديث المركز
                    document.querySelector('.center-circle').innerHTML = `
                        <h3>${subsectionName}</h3>
                        <p>المركز الجديد</p>
                    `;
                    
                    // تحديث شريط التصفح
                    updateBreadcrumb(subsectionName);
                    
                    // إنشاء حلقتين جديدتين
                    const newRings = [
                        { id: 1, innerRadius: 50, outerRadius: 150, name: "الحلقة الداخلية", color: "rgba(76, 161, 175, 0.3)" },
                        { id: 2, innerRadius: 150, outerRadius: 350, name: "الحلقة الخارجية", color: "rgba(255, 126, 95, 0.3)" }
                    ];
                    
                    // الحصول على بيانات الأقسام لهذا القسم الفرعي من قاعدة البيانات
                    const currentData = sectionDatabase[subsectionName];
                    const sectionNames = currentData.sectionNames;
                    const sectionLinks = currentData.sectionLinks;
                    
                    // إنشاء أقسام جديدة للحلقة الخارجية
                    const sectorAngle = (2 * Math.PI) / sectionNames.length;
                    
                    for (let i = 0; i < sectionNames.length; i++) {
                        const startAngle = i * sectorAngle;
                        const endAngle = (i + 1) * sectorAngle;
                        const color = `hsl(${(i * 360) / sectionNames.length}, 70%, 50%)`;
                        
                        // إنشاء القسم الخارجي
                        const outerArcGenerator = d3.arc()
                            .innerRadius(newRings[1].innerRadius)
                            .outerRadius(newRings[1].outerRadius)
                            .startAngle(startAngle)
                            .endAngle(endAngle);
                        
                        const path = svg.append("path")
                            .attr("d", outerArcGenerator())
                            .attr("transform", `translate(${centerX}, ${centerY})`)
                            .attr("fill", color)
                            .attr("stroke", "white")
                            .attr("stroke-width", 1)
                            .attr("opacity", 0.8)
                            .attr("class", "subsection-item")
                            .attr("data-section", i)
                            .on("mouseover", function() {
                                d3.select(this).attr("opacity", 1);
                            })
                            .on("mouseout", function() {
                                d3.select(this).attr("opacity", 0.8);
                            });
                        
                        // إضافة نص القسم مع التصحيح الصحيح للزاوية
                        const middleAngle = startAngle + sectorAngle / 2;
                        const textRadius = (newRings[1].innerRadius + newRings[1].outerRadius) / 2;
                        
                        // تطبيق التصحيح الصحيح للزاوية
                        const correctedAngle = middleAngle + 4.728;
                        
                        const x = centerX + textRadius * Math.cos(correctedAngle);
                        const y = centerY + textRadius * Math.sin(correctedAngle);
                        
                        let rotation = (middleAngle * 180 / Math.PI) + 90;
                        if (rotation > 90 && rotation < 270) {
                            rotation += 180;
                        }
                        
                        // إضافة نص القسم فقط (بدون حدث النقر)
                        const g = svg.append("g")
                            .attr("transform", `translate(${x}, ${y}) rotate(${rotation})`)
                            .attr("class", "subsection-label");
                        
                        const text = g.append("text")
                            .attr("x", 0)
                            .attr("y", 0)
                            .attr("text-anchor", "middle")
                            .attr("dy", "0.35em")
                            .attr("fill", sectionLinks[i] ? "#ffd166" : "#ffffff")
                            .attr("font-size", "10px")
                            .attr("font-weight", "bold")
                            .text(sectionNames[i]);
                        
                        // إضافة أيقونة الرابط إذا كان هناك رابط
                        if (sectionLinks[i]) {
                            // حساب موضع جديد للزر بعيداً عن النص
                            const linkX = centerX + (textRadius + 60) * Math.cos(correctedAngle);
                            const linkY = centerY + (textRadius + 60) * Math.sin(correctedAngle);
                            
                            const linkGroup = svg.append("g")
                                .attr("class", "link-button")
                                .attr("transform", `translate(${linkX}, ${linkY}) rotate(${rotation})`)
                                .on("click", function(event) {
                                    event.stopPropagation(); // منع انتشار الحدث
                                    window.open(sectionLinks[i], '_blank');
                                });
                            
                            // إضافة أيقونة الرابط باستخدام رمز Font Awesome
                            const icon = linkGroup.append("text")
                                .attr("x", 0)
                                .attr("y", 0)
                                .attr("text-anchor", "middle")
                                .attr("dy", "0.35em")
                                .attr("class", "link-icon-text")
                                .text("\uf35d"); // رمز أيقونة الرابط الخارجي
                            
                            // إضافة تلميح للأيقونة
                            icon.append("title")
                                .text("فتح الرابط");
                        }
                    }
                    
                    // إضافة دوائر متقطعة
                    for (let r = 50; r <= 350; r += 100) {
                        svg.append("circle")
                            .attr("cx", centerX)
                            .attr("cy", centerY)
                            .attr("r", r)
                            .attr("fill", "none")
                            .attr("stroke", "rgba(255, 255, 255, 0.2)")
                            .attr("stroke-dasharray", "5,5")
                            .attr("stroke-width", 1);
                    }
                    
                    // إضافة نص في الحلقة الداخلية
                    const innerText = svg.append("text")
                        .attr("x", centerX)
                        .attr("y", centerY)
                        .attr("text-anchor", "middle")
                        .attr("dy", "0.35em")
                        .attr("fill", "#ffd166")
                        .attr("font-size", "16px")
                        .attr("font-weight", "bold")
                        .text("أقسام جديدة");
                    
                    // تعيين القسم النشط
                    activeSection = subsectionName;
                    
                    // إخفاء شاشة الانتقال بعد الانتهاء
                    setTimeout(() => {
                        transitionOverlay.classList.remove('active');
                    }, 500);
                }, 800);
            }
            
            // دالة للعودة إلى الخريطة الرئيسية مع تأثيرات
            function transitionBackToMain() {
                // إظهار شاشة الانتقال
                const transitionOverlay = document.getElementById('transition-overlay');
                transitionOverlay.classList.add('active');
                
                setTimeout(() => {
                    // مسح الخريطة الحالية
                    svg.selectAll("*").remove();
                    
                    nestingLevel = 0;
                    rotationAngle = 0;
                    drawMap();
                    
                    // تحديث المركز
                    document.querySelector('.center-circle').innerHTML = `
                        <h3>سوريا</h3>
                        <p>المركز الرئيسي</p>
                    `;
                    
                    // تحديث شريط التصفح
                    updateBreadcrumb('الخريطة الرئيسية');
                    
                    activeSection = null;
                    
                    // إخفاء شاشة الانتقال بعد الانتهاء
                    setTimeout(() => {
                        transitionOverlay.classList.remove('active');
                    }, 500);
                }, 800);
            }
            
            // تحميل البيانات
            loadData();
            
            // تحديث واجهة الترخيص
            updateLicenseUI();
            
            // رسم الخريطة الأولية
            drawMap();
            
            // تفاعل مع المركز
            document.querySelector('.center-circle').addEventListener('mouseenter', function(e) {
                const tooltip = document.querySelector('.tooltip');
                tooltip.innerHTML = '<strong>مركز منظومة الابتكار</strong><br>سوريا - القلب النابض للمنظومة';
                tooltip.style.opacity = 1;
                tooltip.style.left = (e.pageX + 15) + 'px';
                tooltip.style.top = (e.pageY - 15) + 'px';
            });
            
            document.querySelector('.center-circle').addEventListener('mousemove', function(e) {
                const tooltip = document.querySelector('.tooltip');
                tooltip.style.left = (e.pageX + 15) + 'px';
                tooltip.style.top = (e.pageY - 15) + 'px';
            });
            
            document.querySelector('.center-circle').addEventListener('mouseleave', function() {
                document.querySelector('.tooltip').style.opacity = 0;
            });
            
            document.querySelector('.center-circle').addEventListener('click', function() {
                transitionBackToMain();
            });
            
            // تفاعلات الأزرار
            document.getElementById('reset-view').addEventListener('click', function() {
                transitionBackToMain();
            });
            
            // تدوير الخريطة
            document.getElementById('rotate-left').addEventListener('click', function() {
                rotationAngle -= Math.PI/4; // 45 درجة
                drawMap();
            });
            
            document.getElementById('rotate-right').addEventListener('click', function() {
                rotationAngle += Math.PI/4; // 45 درجة
                drawMap();
            });
            
            // إضافة قسم جديد
            document.getElementById('add-section').addEventListener('click', function() {
                if (!licenseActive) {
                    showNotification('خطأ في الترخيص', 'يجب تفعيل الترخيص أولاً');
                    return;
                }
                
                // فتح نموذج إضافة قسم جديد
                document.getElementById('add-section-modal').classList.add('active');
                document.getElementById('new-section-name').value = '';
                document.getElementById('section-link').value = '';
                document.getElementById('new-section-name').focus();
            });
            
            // تعديل قسم
            document.getElementById('edit-section').addEventListener('click', function() {
                if (!licenseActive) {
                    showNotification('خطأ في الترخيص', 'يجب تفعيل الترخيص أولاً');
                    return;
                }
                
                // تحديث قائمة الأقسام
                updateSectionList();
                
                // فتح نموذج التعديل
                document.getElementById('edit-section-modal').classList.add('active');
                document.getElementById('edit-section-content').value = '';
                document.getElementById('edit-section-link').value = '';
                
                // إلغاء تحديد أي قسم
                document.querySelectorAll('.section-item').forEach(item => {
                    item.classList.remove('active');
                });
            });
            
            // إغلاق نموذج إضافة قسم
            document.getElementById('close-add-modal').addEventListener('click', function() {
                document.getElementById('add-section-modal').classList.remove('active');
            });
            
            document.getElementById('cancel-add-btn').addEventListener('click', function() {
                document.getElementById('add-section-modal').classList.remove('active');
            });
            
            // تأكيد إضافة قسم جديد
            document.getElementById('confirm-add-btn').addEventListener('click', function() {
                const newName = document.getElementById('new-section-name').value.trim();
                const newLink = document.getElementById('section-link').value.trim();
                
                if (newName) {
                    // إضافة الاسم الجديد إلى المصفوفة
                    sectionDatabase[activeSection].sectionNames.push(newName);
                    
                    // إضافة الرابط الجديد
                    sectionDatabase[activeSection].sectionLinks.push(newLink);
                    
                    // إذا كان هناك قسم نشط، أعد رسم الدائرة الجديدة مع زيادة الأقسام
                    if (activeSection) {
                        createNewCircleMap(activeSection);
                    }
                    
                    // حفظ البيانات
                    saveData();
                    
                    // إغلاق النموذج
                    document.getElementById('add-section-modal').classList.remove('active');
                    
                    // عرض إشعار التأكيد
                    showNotification('تمت الإضافة بنجاح!', `تم إضافة قسم جديد باسم: ${newName}`);
                } else {
                    alert('الرجاء إدخال اسم للقسم الجديد');
                }
            });
            
            // إغلاق نموذج تعديل قسم
            document.getElementById('close-edit-modal').addEventListener('click', function() {
                document.getElementById('edit-section-modal').classList.remove('active');
            });
            
            document.getElementById('cancel-edit-btn').addEventListener('click', function() {
                document.getElementById('edit-section-modal').classList.remove('active');
            });
            
            // تأكيد تعديل قسم
            document.getElementById('confirm-edit-btn').addEventListener('click', function() {
                const selectedItem = document.querySelector('.section-item.active');
                const newName = document.getElementById('edit-section-content').value.trim();
                const newLink = document.getElementById('edit-section-link').value.trim();
                
                if (!selectedItem) {
                    alert('الرجاء تحديد قسم للتعديل');
                    return;
                }
                
                if (!newName) {
                    alert('الرجاء إدخال اسم جديد للقسم');
                    return;
                }
                
                const sectionId = parseInt(selectedItem.dataset.id);
                
                // تحديث اسم القسم والرابط
                sectionDatabase[activeSection].sectionNames[sectionId] = newName;
                sectionDatabase[activeSection].sectionLinks[sectionId] = newLink;
                
                // إذا كان هناك قسم نشط، أعد رسم الدائرة الجديدة مع التغييرات
                if (activeSection) {
                    createNewCircleMap(activeSection);
                }
                
                // حفظ البيانات
                saveData();
                
                // إغلاق النموذج
                document.getElementById('edit-section-modal').classList.remove('active');
                
                // عرض إشعار التأكيد
                showNotification('تم التعديل بنجاح!', `تم تحديث القسم رقم ${sectionId + 1} بنجاح`);
            });
            
            // دالة لإظهار إشعار
            function showNotification(title, message) {
                const notification = document.getElementById('notification');
                const titleElement = document.getElementById('notification-title');
                const messageElement = document.getElementById('notification-message');
                
                titleElement.textContent = title;
                messageElement.textContent = message;
                notification.style.display = 'block';
                
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            }
            
            // دالة لتحديث قائمة الأقسام للتعديل
            function updateSectionList() {
                const sectionList = document.getElementById('section-list');
                sectionList.innerHTML = '';
                
                if (!activeSection) return;
                
                const sectionNames = sectionDatabase[activeSection].sectionNames;
                const sectionLinks = sectionDatabase[activeSection].sectionLinks;
                
                sectionNames.forEach((name, index) => {
                    const sectionItem = document.createElement('div');
                    sectionItem.className = 'section-item';
                    sectionItem.dataset.id = index;
                    sectionItem.innerHTML = `
                        <div>
                            <span class="section-name">${name}</span>
                            ${sectionLinks[index] ? 
                                `<span class="section-link"><i class="fas fa-link link-icon"></i> ${sectionLinks[index]}</span>` : 
                                ''}
                        </div>
                        <span class="section-id">${index + 1}</span>
                    `;
                    
                    sectionItem.addEventListener('click', function() {
                        // إزالة التحديد من جميع العناصر
                        document.querySelectorAll('.section-item').forEach(item => {
                            item.classList.remove('active');
                        });
                        
                        // تحديد العنصر الحالي
                        this.classList.add('active');
                        
                        // تعيين محتوى القسم في حقول التعديل
                        document.getElementById('edit-section-content').value = name;
                        document.getElementById('edit-section-link').value = sectionLinks[index] || '';
                    });
                    
                    sectionList.appendChild(sectionItem);
                });
            }
        });
    </script>
</body>
</html>
